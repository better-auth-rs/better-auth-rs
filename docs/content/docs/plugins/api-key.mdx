---
title: API Key
description: Create, manage, and validate API keys with rate limiting and usage tracking.
---

The `ApiKeyPlugin` provides API key management with support for rate limiting, usage quotas, expiration, and permissions.

## Setup

```rust
use better_auth::plugins::ApiKeyPlugin;

let auth = BetterAuth::new(config)
    .database(database)
    .plugin(ApiKeyPlugin::new())
    .build()
    .await?;
```

### Configuration

```rust
use better_auth::plugins::api_key::ApiKeyConfig;

let auth = BetterAuth::new(config)
    .database(database)
    .plugin(
        ApiKeyPlugin::new()
            .key_length(32)
            .prefix("sk_")
            .default_remaining(1000)
    )
    .build()
    .await?;
```

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `key_length` | `usize` | `32` | Length of the random key in bytes |
| `prefix` | `Option<String>` | `None` | Global prefix for all generated keys |
| `default_remaining` | `Option<i64>` | `None` | Default usage quota for new keys |

## How It Works

### Key Generation

API keys are generated using cryptographically secure random bytes, then Base64-encoded (URL-safe, no padding). The key format is:

```
{prefix}{base64_random_bytes}
```

Only the SHA-256 hash of the key is stored in the database. The full key is returned only once during creation and cannot be retrieved later.

### Key Structure

Each API key has:

- **`start`**: First 4 characters of the key (for identification without exposing the full key)
- **`prefix`**: Optional prefix (e.g., `sk_`, `pk_`)
- **`enabled`**: Whether the key is active
- **`remaining`**: Usage quota (decremented on each use, `null` = unlimited)
- **`expiresAt`**: Optional expiration date
- **Rate limiting**: Optional per-key rate limits with refill

## API Endpoints

### Create API Key

```http
POST /api-key/create
Authorization: Bearer <token>
Content-Type: application/json
```

```json
{
  "name": "Production API Key",
  "prefix": "sk_prod_",
  "expiresIn": 2592000000,
  "remaining": 10000,
  "rateLimitEnabled": true,
  "rateLimitTimeWindow": 60000,
  "rateLimitMax": 100,
  "refillInterval": 86400000,
  "refillAmount": 1000,
  "permissions": { "read": true, "write": true },
  "metadata": { "environment": "production" }
}
```

| Field | Required | Description |
|-------|----------|-------------|
| `name` | No | Human-readable key name |
| `prefix` | No | Override the global prefix for this key |
| `expiresIn` | No | Expiration in milliseconds from now |
| `remaining` | No | Usage quota (uses `default_remaining` if not set) |
| `rateLimitEnabled` | No | Enable per-key rate limiting |
| `rateLimitTimeWindow` | No | Rate limit window in milliseconds |
| `rateLimitMax` | No | Max requests per window |
| `refillInterval` | No | Quota refill interval in milliseconds |
| `refillAmount` | No | Amount to refill per interval |
| `permissions` | No | Arbitrary JSON permissions object |
| `metadata` | No | Arbitrary JSON metadata |

#### Response

```json
{
  "key": "sk_prod_dGhpcyBpcyBhIHRlc3Qga2V5...",
  "id": "apikey_uuid",
  "name": "Production API Key",
  "start": "dGhp",
  "prefix": "sk_prod_",
  "userId": "user_uuid",
  "enabled": true,
  "rateLimitEnabled": true,
  "rateLimitTimeWindow": 60000,
  "rateLimitMax": 100,
  "remaining": 10000,
  "expiresAt": "2024-02-01T00:00:00Z",
  "createdAt": "2024-01-01T00:00:00Z",
  "updatedAt": "2024-01-01T00:00:00Z"
}
```

<Callout type="warn">
The `key` field is returned only during creation. Store it securely â€” it cannot be retrieved later.
</Callout>

### Get API Key

```http
GET /api-key/get?id={key_id}
Authorization: Bearer <token>
```

Returns the key metadata (without the full key value). Only the key owner can access it.

### List API Keys

```http
GET /api-key/list
Authorization: Bearer <token>
```

Returns all API keys belonging to the authenticated user.

### Update API Key

```http
POST /api-key/update
Authorization: Bearer <token>
Content-Type: application/json
```

```json
{
  "id": "apikey_uuid",
  "name": "Updated Name",
  "enabled": false,
  "remaining": 5000,
  "rateLimitEnabled": true,
  "rateLimitTimeWindow": 30000,
  "rateLimitMax": 50
}
```

All fields except `id` are optional. Only the key owner can update it.

### Delete API Key

```http
POST /api-key/delete
Authorization: Bearer <token>
Content-Type: application/json
```

```json
{
  "id": "apikey_uuid"
}
```

Only the key owner can delete it.

## Errors

| Status | Condition |
|--------|-----------|
| 400 | Missing or invalid required fields |
| 401 | Not authenticated |
| 404 | API key not found (or not owned by user) |
